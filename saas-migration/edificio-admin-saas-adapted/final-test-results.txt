
> edificio-admin-saas@1.0.0 test:e2e
> node tests/e2e/run-all-tests.js


======================================================================
ğŸš€ SMARTBUILDING SAAS - E2E TESTING SUITE
======================================================================
ğŸ“… Started at: 12/23/2025, 9:56:55 PM
======================================================================


ğŸ“¦ SUITE 1/4: Authentication Tests

ğŸ§ª Testing Authentication Module

==================================================
âœ… POST /api/auth/login - Login exitoso con credenciales vÃ¡lidas
âœ… POST /api/auth/login - Falla con credenciales invÃ¡lidas
âœ… POST /api/auth/login - Falla con email inexistente
âœ… POST /api/auth/login - Valida campos requeridos
âŒ GET /api/auth/renew - Renueva token vÃ¡lido: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âœ… GET /api/auth/renew - Falla sin token
âœ… GET /api/auth/renew - Falla con token invÃ¡lido
âŒ GET /api/auth/perfil - Obtiene perfil de usuario autenticado: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âœ… GET /api/auth/perfil - Falla sin autenticaciÃ³n
âœ… Response time - Login debe responder en <200ms
==================================================

ğŸ“Š Results: 8/10 passed

âŒ Failed tests (2):
  - GET /api/auth/renew - Renueva token vÃ¡lido
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - GET /api/auth/perfil - Obtiene perfil de usuario autenticado
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}


ğŸ“¦ SUITE 2/4: Multitenancy & Data Isolation Tests

ğŸ¢ Testing Multitenancy & Data Isolation

==================================================
âŒ Multitenancy - Admin1 no puede ver usuarios de Building2: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ Multitenancy - Admin2 no puede ver usuarios de Building1: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ Multitenancy - Cuotas estÃ¡n aisladas por building: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ Multitenancy - Gastos estÃ¡n aislados por building: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ Multitenancy - Fondos estÃ¡n aislados por building: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ Multitenancy - Anuncios estÃ¡n aislados por building: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ Multitenancy - No se puede acceder a recursos de otro building por ID: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ Multitenancy - Inquilinos solo ven datos de su building: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
==================================================

ğŸ“Š Results: 0/8 passed

âœ… No data leaks detected - Multitenancy is secure!

âŒ Failed tests (8):
  - Multitenancy - Admin1 no puede ver usuarios de Building2
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Multitenancy - Admin2 no puede ver usuarios de Building1
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Multitenancy - Cuotas estÃ¡n aisladas por building
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Multitenancy - Gastos estÃ¡n aislados por building
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Multitenancy - Fondos estÃ¡n aislados por building
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Multitenancy - Anuncios estÃ¡n aislados por building
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Multitenancy - No se puede acceder a recursos de otro building por ID
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Multitenancy - Inquilinos solo ven datos de su building
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}


ğŸ“¦ SUITE 3/4: Security Audit Tests

ğŸ”’ Security Audit - Comprehensive Testing

==================================================
âœ… Security - JWT - Rechaza tokens malformados
âœ… Security - JWT - Rechaza tokens expirados
âœ… Security - JWT - Rechaza tokens sin firma
âŒ Security - JWT - Valida header x-auth-token: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ Security - RBAC - Inquilino no puede crear usuarios: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ Security - RBAC - Inquilino no puede eliminar usuarios: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ Security - RBAC - Inquilino no puede crear gastos: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ Security - RBAC - Admin puede crear usuarios: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âœ… Security - SQL Injection - Login con payload SQL
âŒ Security - SQL Injection - BÃºsqueda de usuarios con payload: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ Security - XSS - Sanitiza input en creaciÃ³n de usuarios: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ Security - XSS - Sanitiza input en anuncios: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âœ… Security - Rate Limiting - Protege contra brute force en login
âœ… Security - CORS - Headers configurados correctamente
âŒ Security - Password - Rechaza contraseÃ±as dÃ©biles: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ Security - Data Exposure - No expone passwords en responses: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âœ… Security - Data Exposure - No expone JWT secrets
==================================================

ğŸ“Š Results: 7/17 passed

âœ… No critical vulnerabilities detected!

âŒ Failed tests (10):
  - Security - JWT - Valida header x-auth-token
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Security - RBAC - Inquilino no puede crear usuarios
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Security - RBAC - Inquilino no puede eliminar usuarios
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Security - RBAC - Inquilino no puede crear gastos
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Security - RBAC - Admin puede crear usuarios
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Security - SQL Injection - BÃºsqueda de usuarios con payload
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Security - XSS - Sanitiza input en creaciÃ³n de usuarios
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Security - XSS - Sanitiza input en anuncios
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Security - Password - Rechaza contraseÃ±as dÃ©biles
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
  - Security - Data Exposure - No expone passwords en responses
    Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}


ğŸ“¦ SUITE 4/4: API Endpoints Tests (44 endpoints)

ğŸŒ Testing All API Endpoints (44 total)

==================================================

ğŸ“ Testing Auth Endpoints (4)
âŒ POST /api/auth/login: Expected 200, got 429
âœ… POST /api/auth/registro
âŒ GET /api/auth/renew: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
âŒ GET /api/auth/perfil: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}

ğŸ“ Testing Onboarding Endpoints (7)
âœ… POST /api/onboarding/register
âŒ POST /api/otp/send: Unexpected status: 500
âœ… POST /api/otp/verify
âŒ POST /api/otp/resend: Unexpected status: 500
âœ… GET /api/otp/status/:email
âŒ POST /api/onboarding/checkout: Unexpected status: 403
âŒ POST /api/onboarding/setup-building: Unexpected status: 403

ğŸ“ Testing Usuarios Endpoints (5)

ğŸ’¥ Fatal error running tests: Error: Login failed: {"ok":false,"msg":"Demasiadas solicitudes. Por favor intente mÃ¡s tarde.","retryAfter":300}
    at login (file:///home/admin/edifnuev/saas-migration/edificio-admin-saas-adapted/tests/e2e/test-config.js:206:9)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async testUsuariosEndpoints (file:///home/admin/edifnuev/saas-migration/edificio-admin-saas-adapted/tests/e2e/04-api-endpoints.test.js:214:17)
    at async runAllTests (file:///home/admin/edifnuev/saas-migration/edificio-admin-saas-adapted/tests/e2e/04-api-endpoints.test.js:701:3)
    at async runAllTestSuites (file:///home/admin/edifnuev/saas-migration/edificio-admin-saas-adapted/tests/e2e/run-all-tests.js:75:22)
